---
import PublicLayout from "@/layouts/PublicLayout.astro";
import { socialImages } from "@/lib/social-images";
---

<PublicLayout
  title="Contacts"
  description="Contact us"
  keywords="Contacts"
  socialImagePath={socialImages.contact}
>
  <section class="glass-panel rounded-3xl border p-6 shadow-sm md:p-8">
    <h1 class="text-4xl font-semibold tracking-tight">Contacts</h1>
    <p class="mt-3 max-w-2xl text-muted-foreground">Please use this form to contact us.</p>
  </section>

  <section class="mt-4">
    <div class="glass-panel rounded-2xl border p-5 shadow-sm md:p-6">
      <form id="contact-form" class="space-y-3">
        <div>
          <label class="sr-only" for="contact-name">Your name</label>
          <input
            id="contact-name"
            name="name"
            type="text"
            required
            placeholder="Your name *"
            class="h-11 w-full rounded-xl border bg-background px-3 text-sm"
          />
        </div>
        <div>
          <label class="sr-only" for="contact-email">Your email</label>
          <input
            id="contact-email"
            name="email"
            type="email"
            required
            placeholder="Your email *"
            class="h-11 w-full rounded-xl border bg-background px-3 text-sm"
          />
        </div>
        <div>
          <label class="sr-only" for="contact-message">Your message</label>
          <textarea
            id="contact-message"
            name="message"
            required
            placeholder="Your message *"
            class="min-h-40 w-full rounded-xl border bg-background px-3 py-2 text-sm"
          ></textarea>
        </div>
        <div class="hidden" aria-hidden="true">
          <label for="contact-website">Website</label>
          <input id="contact-website" name="website" type="text" autocomplete="off" tabindex="-1" />
        </div>
        <div class="flex items-center gap-3">
          <button
            id="contact-submit"
            type="submit"
            class="rounded-xl bg-primary px-5 py-2.5 text-sm font-semibold text-primary-foreground hover:opacity-90"
          >
            Send message
          </button>
          <p id="contact-status" class="text-sm text-muted-foreground" role="status" aria-live="polite"></p>
        </div>
      </form>
    </div>
  </section>

  <script is:inline>
    const form = document.getElementById("contact-form");
    const status = document.getElementById("contact-status");
    const submit = document.getElementById("contact-submit");

    if (form && status && submit) {
      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        const formData = new FormData(form);
        const payload = {
          name: String(formData.get("name") ?? "").trim(),
          email: String(formData.get("email") ?? "").trim(),
          message: String(formData.get("message") ?? "").trim(),
          website: String(formData.get("website") ?? ""),
        };

        submit.setAttribute("disabled", "disabled");
        status.textContent = "Sending...";

        try {
          const response = await fetch("/api/contact", {
            method: "POST",
            headers: { "content-type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (response.ok) {
            form.reset();
            status.textContent = "Your message has been sent.";
            return;
          }

          if (response.status === 429) {
            status.textContent = "Too many requests. Please try again later.";
            return;
          }

          status.textContent = "Unable to send message. Check your input and try again.";
        } catch {
          status.textContent = "Unable to send message right now. Please try again later.";
        } finally {
          submit.removeAttribute("disabled");
        }
      });
    }
  </script>
</PublicLayout>
