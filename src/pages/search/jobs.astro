---
import PublicLayout from "@/layouts/PublicLayout.astro";
import { buildPaginationState } from "@/lib/pagination";
import SearchFilters from "@/components/search/SearchFilters";

export const prerender = false;

const query = Astro.url.searchParams.get("q") ?? "";
const pagination = buildPaginationState(Astro.url.searchParams.get("page"), 20);

const prevPage = pagination.page > 1 ? pagination.page - 1 : null;
const nextPage = pagination.page + 1;
const currentPath = `${Astro.url.pathname}${Astro.url.search}`;

function buildPageHref(page: number): string {
  const url = new URL("/search/jobs", Astro.url);
  if (query) {
    url.searchParams.set("q", query);
  }
  url.searchParams.set("page", String(page));
  return `${url.pathname}${url.search}`;
}
---

<PublicLayout
  title="Job Search"
  description="Browse and search jobs."
  canonicalPath={currentPath}
  prevPath={prevPage ? buildPageHref(prevPage) : undefined}
  nextPath={buildPageHref(nextPage)}
  jsonLd={{
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    name: "Job Search",
    url: currentPath,
  }}
>
  <section class="glass-panel rounded-3xl border p-6 shadow-sm md:p-8">
    <p class="text-xs font-semibold tracking-[0.16em] text-muted-foreground uppercase">Talent Search</p>
    <h1 class="mt-3 text-4xl font-semibold tracking-tight">Remote Job Search</h1>
    <p class="mt-3 max-w-2xl text-muted-foreground">
      Discover active roles with location, stack, and contract flexibility. This page is already wired for
      URL-state filtering and pagination.
    </p>
    <SearchFilters client:load basePath="/search/jobs" initialQuery={query} />
    <p class="mt-2 text-sm text-muted-foreground">
      Current query: <code>{query || "(none)"}</code>. Page: <code>{pagination.page}</code>.
    </p>
  </section>

  <section class="mt-4 grid gap-3 md:grid-cols-2">
    <article class="glass-panel rounded-2xl border p-4">
      <h2 class="text-lg font-semibold">What lands next</h2>
      <p class="mt-2 text-sm text-muted-foreground">
        Server-authoritative result set, category/country filters, and persisted query chips.
      </p>
    </article>
    <article class="glass-panel rounded-2xl border p-4">
      <h2 class="text-lg font-semibold">Routing behavior</h2>
      <p class="mt-2 text-sm text-muted-foreground">
        Pagination uses canonical URLs and `prev/next` links for crawl consistency.
      </p>
    </article>
  </section>

  <nav class="mt-6 flex items-center gap-3 text-sm">
    {
      prevPage
        ? <a class="rounded-full border px-4 py-2 hover:bg-secondary" href={buildPageHref(prevPage)}>Previous</a>
        : <span class="rounded-full border px-4 py-2 text-muted-foreground">Previous</span>
    }
    <a class="rounded-full border px-4 py-2 hover:bg-secondary" href={buildPageHref(nextPage)}>Next</a>
  </nav>
</PublicLayout>
