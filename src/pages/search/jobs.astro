---
import PublicLayout from "@/layouts/PublicLayout.astro";
import { buildPaginationState } from "@/lib/pagination";

export const prerender = false;

const query = Astro.url.searchParams.get("q") ?? "";
const pagination = buildPaginationState(Astro.url.searchParams.get("page"), 20);

const prevPage = pagination.page > 1 ? pagination.page - 1 : null;
const nextPage = pagination.page + 1;

function buildPageHref(page: number): string {
  const url = new URL("/search/jobs", Astro.url);
  if (query) {
    url.searchParams.set("q", query);
  }
  url.searchParams.set("page", String(page));
  return `${url.pathname}${url.search}`;
}
---

<PublicLayout title="Job Search" description="Browse and search jobs.">
  <h1 class="text-3xl font-semibold tracking-tight">Job Search</h1>
  <p class="mt-3 text-muted-foreground">
    URL-state scaffold is active. Query: <code>{query || "(none)"}</code>. Page: <code>{pagination.page}</code>.
  </p>
  <p class="mt-2 text-muted-foreground">Server-backed data query lands next in W3-2.</p>
  <nav class="mt-6 flex gap-4 text-sm">
    {
      prevPage ? <a class="underline" href={buildPageHref(prevPage)}>Previous</a> : <span>Previous</span>
    }
    <a class="underline" href={buildPageHref(nextPage)}>Next</a>
  </nav>
</PublicLayout>
