---
import PublicLayout from "@/layouts/PublicLayout.astro";
import { socialImages } from "@/lib/social-images";
import { buildPaginationState } from "@/lib/pagination";
import SearchFilters from "@/components/search/SearchFilters";

export const prerender = false;

const query = Astro.url.searchParams.get("q") ?? "";
const pagination = buildPaginationState(Astro.url.searchParams.get("page"), 20);

const prevPage = pagination.page > 1 ? pagination.page - 1 : null;
const nextPage = pagination.page + 1;
const currentPath = `${Astro.url.pathname}${Astro.url.search}`;

function buildPageHref(page: number): string {
  const url = new URL("/search/resumes", Astro.url);
  if (query) {
    url.searchParams.set("q", query);
  }
  url.searchParams.set("page", String(page));
  return `${url.pathname}${url.search}`;
}
---

<PublicLayout
  title="Resume Search"
  description="Browse and search resumes."
  canonicalPath={currentPath}
  socialImagePath={socialImages.resumes}
  prevPath={prevPage ? buildPageHref(prevPage) : undefined}
  nextPath={buildPageHref(nextPage)}
  jsonLd={{
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    name: "Resume Search",
    url: currentPath,
  }}
>
  <section class="glass-panel rounded-3xl border p-6 shadow-sm md:p-8">
    <p class="text-xs font-semibold tracking-[0.16em] text-muted-foreground uppercase">Candidate Search</p>
    <h1 class="mt-3 text-4xl font-semibold tracking-tight">Remote Resume Search</h1>
    <p class="mt-3 max-w-2xl text-muted-foreground">
      Explore candidate profiles across disciplines and availability windows. URL query state is active and ready
      for server-backed indexing.
    </p>
    <SearchFilters client:load basePath="/search/resumes" initialQuery={query} />
    <p class="mt-2 text-sm text-muted-foreground">
      Current query: <code>{query || "(none)"}</code>. Page: <code>{pagination.page}</code>.
    </p>
  </section>

  <section class="mt-4 grid gap-3 md:grid-cols-2">
    <article class="glass-panel rounded-2xl border p-4">
      <h2 class="text-lg font-semibold">What lands next</h2>
      <p class="mt-2 text-sm text-muted-foreground">
        DB-backed resume search, compensation filters, and profile completeness signals.
      </p>
    </article>
    <article class="glass-panel rounded-2xl border p-4">
      <h2 class="text-lg font-semibold">Routing behavior</h2>
      <p class="mt-2 text-sm text-muted-foreground">
        Canonical paginated URLs are preserved to support crawl and sharing consistency.
      </p>
    </article>
  </section>

  <nav class="mt-6 flex items-center gap-3 text-sm">
    {
      prevPage
        ? <a class="rounded-full border px-4 py-2 hover:bg-secondary" href={buildPageHref(prevPage)}>Previous</a>
        : <span class="rounded-full border px-4 py-2 text-muted-foreground">Previous</span>
    }
    <a class="rounded-full border px-4 py-2 hover:bg-secondary" href={buildPageHref(nextPage)}>Next</a>
  </nav>
</PublicLayout>
